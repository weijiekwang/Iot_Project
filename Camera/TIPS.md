# 使用技巧和调试指南

## 🎯 动作识别技巧

### 1. 挥手 (Hi)
**正确做法：**
- 举起一只手，手腕要高于肩膀
- 手掌朝向摄像头
- 左右摆动手臂至少2-3次
- 摆动幅度要明显（至少30厘米）

**常见问题：**
- ❌ 手举得不够高
- ❌ 摆动幅度太小
- ❌ 摆动速度太快或太慢

### 2. 双手举高 (Wow)
**正确做法：**
- 双手同时向上举起
- 双手都要高于头部（高于鼻子位置）
- 手肘也要抬起，不能弯曲太多
- 保持姿势1-2秒

**常见问题：**
- ❌ 只举起一只手
- ❌ 手举得不够高（没超过头部）
- ❌ 手肘弯曲太多

### 3. 双手叉腰 (Cool)
**正确做法：**
- 双手放在腰部两侧（臀部上方）
- 手肘向外，形成叉腰姿势
- 手腕位置在肩膀和臀部之间
- 保持姿势1-2秒

**提示：这个动作不会和其他任何动作冲突！**

**常见问题：**
- ❌ 手的位置太高（在胸前）
- ❌ 手的位置太低（低于臀部）
- ❌ 手臂没有弯曲，只是放在身体侧面

### 4. 鼓掌 (Good)
**正确做法：**
- 双手在胸前位置（肩膀到腰部之间）
- 用力拍手2-3次
- 拍手时双手要完全靠近
- 拍手幅度要明显（至少20厘米）

**常见问题：**
- ❌ 双手位置太高或太低
- ❌ 拍手幅度太小
- ❌ 拍手速度太快，系统来不及识别

### 5. 点头 (Yes)
**正确做法：**
- 保持身体不动，只动头部
- 上下点头2-3次
- 点头幅度适中（不需要很大）
- 速度适中，不要太快

**提示：已大幅优化！现在更容易识别了！**

**常见问题：**
- ❌ 点头幅度太小
- ❌ 速度太快，系统来不及识别
- ❌ 整个身体一起动

### 6. 摇头 (No)
**正确做法：**
- 保持身体不动，只动头部
- 左右摇头2-3次
- 摇头幅度要明显（至少5-8厘米水平移动）
- 速度适中，不要太快

**提示：已重新调整阈值，减少误触发！**

**常见问题：**
- ❌ 摇头幅度太小
- ❌ 速度太快
- ❌ 整个身体一起转

## 🔧 优化建议

### 环境设置
1. **光线充足**：确保脸部和身体光线均匀
2. **背景简洁**：避免复杂背景干扰
3. **距离适中**：站在距离摄像头1-2米处
4. **完整入镜**：确保头部到腰部都在画面中

### 性能优化
如果程序运行卡顿，可以：

1. **降低摄像头分辨率**（在代码中添加）：
```python
cap = cv2.VideoCapture(0)
cap.set(cv2.CAP_PROP_FRAME_WIDTH, 640)
cap.set(cv2.CAP_PROP_FRAME_HEIGHT, 480)
```

2. **关闭其他占用摄像头的程序**

3. **调整MediaPipe性能**（在代码中修改）：
```python
self.pose = self.mp_pose.Pose(
    model_complexity=0,  # 改为0（更快但精度略低）
    min_detection_confidence=0.5,
    min_tracking_confidence=0.5
)
```

## 🐛 常见问题解决

### 问题1：一直输出 Yes
**原因：** 点头检测过于敏感，微小的头部移动被识别为点头
**解决方案：** 已在新版本中提高阈值
- 要求至少20像素的垂直移动范围
- 需要明显的波峰和波谷

### 问题2：无法用 'q' 键退出
**原因：** 窗口焦点问题
**解决方案：**
1. 确保点击了OpenCV窗口（使其获得焦点）
2. 然后按 'q' 键
3. 或者直接关闭窗口（已支持）
4. 最后手段：Ctrl+C

### 问题3：检测不到动作
**可能原因和解决方案：**

1. **光线问题**
   - 增加房间照明
   - 避免背光

2. **距离问题**
   - 调整到1-2米距离
   - 确保全身入镜

3. **动作幅度问题**
   - 增大动作幅度
   - 放慢动作速度

4. **阈值太严格**
   - 可以在代码中调整阈值（见下方）

## ⚙️ 参数调整

如果需要让识别更灵敏或更严格，可以调整这些参数：

### 点头检测灵敏度
```python
# 在 detect_nod 函数中
movement_range < 8  # 已优化！降低到6可以更灵敏
peaks >= 1 and valleys >= 1  # 改为 >= 0 更容易触发
```

### 摇头检测灵敏度
```python
# 在 detect_shake 函数中
movement_range < 25  # 已调整！降低到20可以更灵敏（但可能误触发）
direction_changes >= 2  # 已调整为2，改为1会更容易触发
```

### 挥手检测灵敏度
```python
# 在 detect_wave 函数中
direction_changes >= 2  # 改为 >= 1 更容易触发
x_changes[i] > 5  # 降低到3可以检测更小的摆动
```

### 双手举高检测灵敏度
```python
# 在 detect_raise_hands 函数中
left_wrist.y < nose.y  # 调整高度要求
left_wrist.y < left_shoulder.y - 0.1  # 调整与肩膀的距离
```

### 双手叉腰检测灵敏度
```python
# 在 detect_hands_on_hips 函数中
left_wrist.y > left_shoulder.y + 0.1  # 调整手腕高度范围
abs(left_wrist_x - left_hip_x) < 80  # 调整手腕与臀部的水平距离容差
```

### 鼓掌检测灵敏度
```python
# 在 detect_clap 函数中
max_distance - min_distance > 80  # 降低到60可以检测更小幅度的拍手
close_count >= 2 and far_count >= 2  # 改为 >= 1 更容易触发
```

### 冷却时间
```python
# 在 __init__ 函数中
self.gesture_cooldown = 2.0  # 降低到1.0可以更快重复识别
```

## 📊 调试模式

如果想看到更多调试信息，可以在代码中添加：

```python
# 在 process_frame 函数的 if results.pose_landmarks: 之后添加
print(f"鼻子Y: {landmarks[0].y:.3f}, 变化范围: {max(self.nose_y_history)-min(self.nose_y_history) if self.nose_y_history else 0:.1f}")
```

## 💡 使用建议

1. **初次使用**：先测试每个动作，熟悉系统的响应
2. **动作要明显**：比日常动作幅度更大一些
3. **保持稳定**：除了要识别的动作外，其他部位尽量不动
4. **耐心等待**：识别需要一定时间，不要做完动作立即停止
5. **注意冷却**：每个动作识别后有2秒冷却时间
6. **双手动作**：比心、鼓掌等需要双手配合，确保双手都在画面中

## 🚀 下一步扩展

准备好后，可以添加：
1. **语音识别**：使用 `speech_recognition` 库
2. **语音合成**：使用 `pyttsx3` 库
3. **对话功能**：集成 ChatGPT API
4. **更换摄像头**：改为ESP32-CAM或树莓派摄像头
5. **添加更多动作**：竖大拇指、V字手势、OK手势等
