# 智能盆栽动作识别系统

这是一个基于电脑摄像头的动作识别系统，能够识别以下动作：
- **挥手打招呼** → 输出 "Hi"
- **跳跃** → 输出 "Jump"
- **点头** → 输出 "Yes"
- **摇头** → 输出 "No"

## 技术方案

### 使用的库和模型
1. **MediaPipe Pose** - Google开发的免费姿态估计模型
   - 优点：轻量级、快速、准确
   - 完全免费，无需API密钥
   - 可以实时检测33个身体关键点

2. **OpenCV** - 计算机视觉库
   - 用于摄像头捕获和图像处理

3. **NumPy** - 数值计算库
   - 用于处理坐标和计算

### 动作识别原理

1. **挥手打招呼**
   - 检测手腕是否举起（高于肩膀）
   - 跟踪手腕的水平位置变化
   - 识别左右摆动模式

2. **跳跃**
   - 跟踪臀部的垂直位置
   - 检测明显的向上位移
   - 比较历史高度数据

3. **点头**
   - 跟踪鼻子的垂直位置
   - 识别上下运动模式
   - 检测波峰和波谷

4. **摇头**
   - 跟踪鼻子的水平位置
   - 识别左右摆动模式
   - 检测方向变化

## 安装步骤

### 1. 安装Python
确保你的电脑上安装了Python 3.8或更高版本。

### 2. 安装依赖包
考虑到大家环境可能不一样，我推荐大家建造一个LOTplanter环境再进行（可选）
```bash
conda create -n LOTplanter python=3.11 -y

conda activate LOTplanter

```
打开命令行（Windows: cmd 或 PowerShell，Mac: Terminal），进入项目文件夹，运行：

```bash
pip install -r requirements.txt
```

或者单独安装：
```bash
pip install opencv-python mediapipe numpy
```

## 运行程序

在项目文件夹中运行：

```bash
python gesture_recognition.py
```

# 使用技巧和调试指南

## 🎯 动作识别技巧

### 1. 挥手 (Hi)
**正确做法：**
- 举起一只手，手腕要高于肩膀
- 手掌朝向摄像头
- 左右摆动手臂至少2-3次
- 摆动幅度要明显（至少30厘米）

**常见问题：**
- ❌ 手举得不够高
- ❌ 摆动幅度太小
- ❌ 摆动速度太快或太慢

### 2. 跳跃 (Jump)
**正确做法：**
- 原地双脚跳起
- 跳跃高度至少10厘米
- 确保上半身在摄像头视野内

**常见问题：**
- ❌ 跳得太低
- ❌ 只抬脚不跳
- ❌ 身体移出画面

### 3. 点头 (Yes)
**正确做法：**
- 保持身体不动，只动头部
- 上下点头2-3次
- 点头幅度要明显（至少5厘米垂直移动）
- 速度适中，不要太快

**常见问题：**
- ❌ 点头幅度太小
- ❌ 速度太快，系统来不及识别
- ❌ 整个身体一起动

### 4. 摇头 (No)
**正确做法：**
- 保持身体不动，只动头部
- 左右摇头2-3次
- 摇头幅度要明显（至少5厘米水平移动）
- 速度适中

**常见问题：**
- ❌ 摇头幅度太小
- ❌ 速度太快
- ❌ 整个身体一起转

## 🔧 优化建议

### 环境设置
1. **光线充足**：确保脸部和身体光线均匀
2. **背景简洁**：避免复杂背景干扰
3. **距离适中**：站在距离摄像头1-2米处
4. **完整入镜**：确保头部到腰部都在画面中

### 性能优化
如果程序运行卡顿，可以：

1. **降低摄像头分辨率**（在代码中添加）：
```python
cap = cv2.VideoCapture(0)
cap.set(cv2.CAP_PROP_FRAME_WIDTH, 640)
cap.set(cv2.CAP_PROP_FRAME_HEIGHT, 480)
```

2. **关闭其他占用摄像头的程序**

3. **调整MediaPipe性能**（在代码中修改）：
```python
self.pose = self.mp_pose.Pose(
    model_complexity=0,  # 改为0（更快但精度略低）
    min_detection_confidence=0.5,
    min_tracking_confidence=0.5
)
```

## 🐛 常见问题解决

### 问题1：一直输出 Yes
**原因：** 点头检测过于敏感，微小的头部移动被识别为点头
**解决方案：** 已在新版本中提高阈值
- 要求至少20像素的垂直移动范围
- 需要明显的波峰和波谷

### 问题2：无法用 'q' 键退出
**原因：** 窗口焦点问题
**解决方案：**
1. 确保点击了OpenCV窗口（使其获得焦点）
2. 然后按 'q' 键
3. 或者直接关闭窗口（已支持）
4. 最后手段：Ctrl+C

### 问题3：检测不到动作
**可能原因和解决方案：**

1. **光线问题**
   - 增加房间照明
   - 避免背光

2. **距离问题**
   - 调整到1-2米距离
   - 确保全身入镜

3. **动作幅度问题**
   - 增大动作幅度
   - 放慢动作速度

4. **阈值太严格**
   - 可以在代码中调整阈值（见下方）

## ⚙️ 参数调整

如果需要让识别更灵敏或更严格，可以调整这些参数：

### 点头检测灵敏度
```python
# 在 detect_nod 函数中
movement_range < 20  # 降低到15可以更灵敏
peaks >= 1 and valleys >= 1  # 改为 >= 0 更容易触发
```

### 摇头检测灵敏度
```python
# 在 detect_shake 函数中
movement_range < 30  # 降低到20可以更灵敏
direction_changes >= 2  # 改为 >= 1 更容易触发
```

### 挥手检测灵敏度
```python
# 在 detect_wave 函数中
direction_changes >= 2  # 改为 >= 1 更容易触发
x_changes[i] > 5  # 降低到3可以检测更小的摆动
```

### 跳跃检测灵敏度
```python
# 在 detect_jump 函数中
recent_min - current > 30  # 降低到20可以检测更小的跳跃
```

### 冷却时间
```python
# 在 __init__ 函数中
self.gesture_cooldown = 2.0  # 降低到1.0可以更快重复识别
```

## 📊 调试模式

如果想看到更多调试信息，可以在代码中添加：

```python
# 在 process_frame 函数的 if results.pose_landmarks: 之后添加
print(f"鼻子Y: {landmarks[0].y:.3f}, 变化范围: {max(self.nose_y_history)-min(self.nose_y_history) if self.nose_y_history else 0:.1f}")
```

## 💡 使用建议

1. **初次使用**：先测试每个动作，熟悉系统的响应
2. **动作要明显**：比日常动作幅度更大一些
3. **保持稳定**：除了要识别的动作外，其他部位尽量不动
4. **耐心等待**：识别需要一定时间，不要做完动作立即停止
5. **注意冷却**：每个动作识别后有2秒冷却时间

## 🚀 下一步扩展

准备好后，可以添加：
1. **语音识别**：使用 `speech_recognition` 库
2. **语音合成**：使用 `pyttsx3` 库
3. **对话功能**：集成 ChatGPT API
4. **更换摄像头**：改为ESP32-CAM或树莓派摄像头
5. **添加更多动作**：比心、鼓掌、敬礼等


## 后续扩展

这个代码已经为盆栽系统做好准备：

1. **更换摄像头**
   - 将 `cv2.VideoCapture(0)` 改为盆栽摄像头的地址
   - 例如：`cv2.VideoCapture('http://盆栽IP:端口/video')`

2. **添加语音识别**
   - 可以集成 `speech_recognition` 库
   - 或使用 Google Speech API

3. **添加对话功能**
   - 可以集成 ChatGPT API 或其他对话模型
   - 使用 `pyttsx3` 进行语音合成

4. **添加更多动作**
   - 可以基于MediaPipe的33个关键点添加新动作
   - 例如：鼓掌、比心、敬礼等

## 常见问题

**Q: 摄像头打不开？**
A: 检查摄像头权限，确保没有其他程序占用摄像头。

**Q: 识别不准确？**
A: 
- 确保光线充足
- 保持适当距离（1-2米）
- 动作要明显清晰
- 调整代码中的阈值参数

**Q: 程序运行慢？**
A: 
- 降低摄像头分辨率
- 调整MediaPipe的复杂度设置
- 关闭不必要的后台程序

## 系统要求

- Python 3.8+
- 摄像头（内置或外接）
- CPU: 建议i5或以上
- RAM: 至少4GB
- 操作系统: Windows 10/11, macOS, Linux

## 免费API和工具

本项目使用的所有库都是免费的：
- MediaPipe: 完全免费开源
- OpenCV: 免费开源
- NumPy: 免费开源

无需任何付费API或注册！
