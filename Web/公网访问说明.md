# 🌐 公网访问配置指南

## 问题：5000端口被占用

macOS系统的AirPlay Receiver默认占用5000端口，所以我们改用**8080端口**。

## 🚀 三种访问方式

### 方式1: 本地访问（最简单）⭐

```bash
python Web/app.py
```

访问: `http://localhost:8080`

**适用场景**: 只在自己电脑上使用

---

### 方式2: 局域网访问

```bash
python Web/app.py
```

1. 查看本机IP地址
```bash
# macOS/Linux
ifconfig | grep "inet "

# Windows
ipconfig
```

2. 其他设备访问
```
http://[你的IP]:8080
例如: http://192.168.1.100:8080
```

**适用场景**: 
- 同一WiFi下的手机/平板访问
- 家庭/办公室内部使用

---

### 方式3: 公网访问（推荐）🌍

#### 使用 ngrok（最简单）

**第一步：安装 pyngrok**
```bash
pip install pyngrok
```

**第二步：运行公网版本**
```bash
python Web/app_public.py
```

**第三步：获取公网链接**
程序会自动显示：
```
✅ 公网访问链接: https://xxxx-xx-xxx-xxx.ngrok-free.app
📱 任何人都可以通过这个链接访问你的网站！
```

**特点：**
- ✅ 任何人都能访问（通过互联网）
- ✅ 自动HTTPS加密
- ✅ 无需配置路由器
- ⚠️ 免费版24小时后链接会变

---

#### 使用 localtunnel（备选）

**第一步：安装 localtunnel**
```bash
npm install -g localtunnel
```

**第二步：启动服务器**
```bash
python Web/app.py
```

**第三步：在新终端创建隧道**
```bash
lt --port 8080
```

**获得链接：**
```
your url is: https://xxxx-xxxx.loca.lt
```

---

## 📊 对比表

| 方式 | 访问范围 | 配置难度 | 适用场景 |
|------|---------|---------|---------|
| 本地 | 仅本机 | ⭐ 最简单 | 开发测试 |
| 局域网 | 同WiFi | ⭐⭐ 简单 | 家庭/办公室 |
| Ngrok | 全球 | ⭐⭐⭐ 一般 | 演示/远程访问 |
| Localtunnel | 全球 | ⭐⭐⭐ 一般 | 备用方案 |

## 🎯 推荐方案

### 开发测试阶段
使用**本地访问**
```bash
python Web/app.py
# 访问 http://localhost:8080
```

### 团队演示/远程访问
使用**ngrok公网访问**
```bash
pip install pyngrok
python Web/app_public.py
# 分享生成的链接给其他人
```

### 长期使用
考虑部署到云服务器（AWS、阿里云等）

## 💡 使用技巧

### Ngrok技巧

**保持固定域名**（付费功能）
```bash
ngrok http 8080 --domain=your-domain.ngrok.io
```

**查看访问日志**
访问: http://localhost:4040

**设置访问密码**
```bash
ngrok http 8080 --basic-auth="username:password"
```

### 安全建议

1. **不要分享给陌生人**: 公网链接任何人都能访问
2. **定期更换链接**: 免费版每次重启链接会变
3. **添加访问限制**: 生产环境建议加密和认证
4. **关闭不用的服务**: 用完记得停止服务器

## 🐛 常见问题

### Q1: ngrok安装失败？
```bash
# 先安装ngrok命令行工具
brew install ngrok  # macOS

# 然后安装Python包
pip install pyngrok
```

### Q2: 5000端口仍然被占用？
**macOS解决方案：**
1. 系统设置 → 通用 → 隔空播放接收器
2. 关闭"允许接收Handoff"

或者直接使用8080端口（已修改）

### Q3: 局域网访问不了？
检查：
1. 防火墙设置
2. 确保使用0.0.0.0监听（已配置）
3. IP地址是否正确

### Q4: ngrok链接打不开？
可能原因：
1. 网络问题（需要访问ngrok服务器）
2. 免费账号限制
3. 服务器未启动

解决：
```bash
# 检查ngrok状态
curl http://localhost:4040/api/tunnels

# 重启服务
python Web/app_public.py
```

### Q5: 想要永久固定的域名？
选项：
1. 购买ngrok付费版（$8/月起）
2. 使用自己的域名 + frp
3. 部署到云服务器

## 📱 移动端访问

使用公网链接后，可以：
- 在手机浏览器打开链接
- 添加到主屏幕（像APP一样使用）
- 随时随地查看植物状态

## 🔗 相关资源

- Ngrok官网: https://ngrok.com
- Localtunnel: https://localtunnel.me
- Flask文档: https://flask.palletsprojects.com

---

## 🎬 快速开始

**最简单方案（本地）：**
```bash
python Web/app.py
# 打开 http://localhost:8080
```

**公网访问方案：**
```bash
pip install pyngrok
python Web/app_public.py
# 复制显示的公网链接，发给任何人！
```

就是这么简单！🎉
